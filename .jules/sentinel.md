## 2026-02-26 - Content Security Policy & Import Maps
**Vulnerability:** The application lacked a Content Security Policy (CSP), leaving it vulnerable to XSS. Implementing a strict CSP was blocked by the use of inline styles in `innerHTML` (e.g., in `updateLegend`) and an inline import map script.
**Learning:** Import maps are often defined inline for performance and simplicity, but this conflicts with `script-src 'self'`. While hashes (e.g., `sha256-...`) can whitelist specific inline scripts, any change to the script (even whitespace) invalidates the hash. Additionally, dynamic style injection via `innerHTML` strings (e.g., `style="background:..."`) is blocked by `style-src 'self'`, necessitating a refactor to `document.createElement` and direct `element.style` manipulation.
**Prevention:** When designing for CSP, prefer external scripts/styles or use `document.createElement` for dynamic content. For inline scripts like import maps, automate hash generation during build/deployment or move them to external files if supported.
